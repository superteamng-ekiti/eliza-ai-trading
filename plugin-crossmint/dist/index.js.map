{"version":3,"sources":["../src/actions.ts","../src/wallet.ts","../src/index.ts"],"sourcesContent":["import {\n    type WalletClient,\n    type Plugin,\n    addParametersToDescription,\n    type Tool,\n    getTools,\n} from \"@goat-sdk/core\";\nimport {\n    type Action,\n    generateText,\n    type HandlerCallback,\n    type IAgentRuntime,\n    type Memory,\n    ModelClass,\n    type State,\n    composeContext,\n    generateObjectV2,\n} from \"@ai16z/eliza\";\n\ntype GetOnChainActionsParams<TWalletClient extends WalletClient> = {\n    wallet: TWalletClient;\n    plugins: Plugin<TWalletClient>[];\n};\n\n/**\n * Get all the on chain actions for the given wallet client and plugins\n *\n * @param params\n * @returns\n */\nexport async function getOnChainActions<TWalletClient extends WalletClient>({\n    wallet,\n    plugins,\n}: GetOnChainActionsParams<TWalletClient>): Promise<Action[]> {\n    const tools = await getTools<TWalletClient>({\n        wallet,\n        plugins,\n        wordForTool: \"action\",\n    });\n\n    return tools\n        .map((action) => ({\n            ...action,\n            name: action.name.toUpperCase(),\n        }))\n        .map((tool) => createAction(tool));\n}\n\nfunction createAction(tool: Tool): Action {\n    return {\n        name: tool.name,\n        similes: [],\n        description: tool.description,\n        validate: async () => true,\n        handler: async (\n            runtime: IAgentRuntime,\n            message: Memory,\n            state: State | undefined,\n            options?: Record<string, unknown>,\n            callback?: HandlerCallback\n        ): Promise<boolean> => {\n            try {\n                let currentState =\n                    state ?? (await runtime.composeState(message));\n                currentState =\n                    await runtime.updateRecentMessageState(currentState);\n\n                const parameterContext = composeParameterContext(\n                    tool,\n                    currentState\n                );\n                const parameters = await generateParameters(\n                    runtime,\n                    parameterContext,\n                    tool\n                );\n\n                const parsedParameters = tool.parameters.safeParse(parameters);\n                if (!parsedParameters.success) {\n                    callback?.({\n                        text: `Invalid parameters for action ${tool.name}: ${parsedParameters.error.message}`,\n                        content: { error: parsedParameters.error.message },\n                    });\n                    return false;\n                }\n\n                const result = await tool.method(parsedParameters.data);\n                const responseContext = composeResponseContext(\n                    tool,\n                    result,\n                    currentState\n                );\n                const response = await generateResponse(\n                    runtime,\n                    responseContext\n                );\n\n                callback?.({ text: response, content: result });\n                return true;\n            } catch (error) {\n                const errorMessage =\n                    error instanceof Error ? error.message : String(error);\n                callback?.({\n                    text: `Error executing action ${tool.name}: ${errorMessage}`,\n                    content: { error: errorMessage },\n                });\n                return false;\n            }\n        },\n        examples: [],\n    };\n}\n\nfunction composeParameterContext(tool: Tool, state: State): string {\n    const contextTemplate = `{{recentMessages}}\n\nGiven the recent messages, extract the following information for the action \"${tool.name}\":\n${addParametersToDescription(\"\", tool.parameters)}\n`;\n    return composeContext({ state, template: contextTemplate });\n}\n\nasync function generateParameters(\n    runtime: IAgentRuntime,\n    context: string,\n    tool: Tool\n): Promise<unknown> {\n    const { object } = await generateObjectV2({\n        runtime,\n        context,\n        modelClass: ModelClass.LARGE,\n        schema: tool.parameters,\n    });\n\n    return object;\n}\n\nfunction composeResponseContext(\n    tool: Tool,\n    result: unknown,\n    state: State\n): string {\n    const responseTemplate = `\n    # Action Examples\n{{actionExamples}}\n(Action examples are for reference only. Do not use the information from them in your response.)\n\n# Knowledge\n{{knowledge}}\n\n# Task: Generate dialog and actions for the character {{agentName}}.\nAbout {{agentName}}:\n{{bio}}\n{{lore}}\n\n{{providers}}\n\n{{attachments}}\n\n# Capabilities\nNote that {{agentName}} is capable of reading/seeing/hearing various forms of media, including images, videos, audio, plaintext and PDFs. Recent attachments have been included above under the \"Attachments\" section.\n\nThe action \"${tool.name}\" was executed successfully.\nHere is the result:\n${JSON.stringify(result)}\n\n{{actions}}\n\nRespond to the message knowing that the action was successful and these were the previous messages:\n{{recentMessages}}\n  `;\n    return composeContext({ state, template: responseTemplate });\n}\n\nasync function generateResponse(\n    runtime: IAgentRuntime,\n    context: string\n): Promise<string> {\n    return generateText({\n        runtime,\n        context,\n        modelClass: ModelClass.LARGE,\n    });\n}\n","import { WalletClient } from \"@goat-sdk/core\";\nimport { Connection } from \"@solana/web3.js\";\nimport { crossmint } from \"@goat-sdk/crossmint\";\n\nexport async function getWalletClientAndConnection(\n    getSetting: (key: string) => string | undefined\n) {\n    const apiKey = getSetting(\"CROSSMINT_API_KEY\");\n    if (!apiKey) {\n        throw new Error(\"Missing CROSSMINT_API_KEY variable\");\n    }\n    const email = getSetting(\"CROSSMINT_EMAIL\");\n    if (!email) {\n        throw new Error(\"Missing CROSSMINT_EMAIL variable\");\n    }\n    const env = getSetting(\"CROSSMINT_ENV\");\n    if (!env) {\n        throw new Error(\"Missing CROSSMINT_ENV variable\");\n    }\n    const RPC_URL = getSetting(\"RPC_URL\");\n    if (!RPC_URL) {\n        throw new Error(\"Missing RPC_URL variable\");\n    }\n\n    const { custodial } = crossmint(apiKey);\n\n    const connection = new Connection(RPC_URL, \"confirmed\");\n\n    return {\n        walletClient: await custodial({\n            chain: \"solana\",\n            email: email,\n            env: env as \"staging\" | \"production\",\n            connection: connection,\n        }),\n        connection: connection,\n    };\n}\n\nexport function getWalletProvider(walletClient: WalletClient) {\n    return {\n        async get(): Promise<string | null> {\n            try {\n                const address = walletClient.getAddress();\n                const balance = await walletClient.balanceOf(address);\n                return `Solana Wallet Address: ${address}\\nBalance: ${balance} SOL`;\n            } catch (error) {\n                console.error(\"Error in Solana wallet provider:\", error);\n                return null;\n            }\n        },\n    };\n}\n","import type { Plugin } from \"@ai16z/eliza\";\nimport { getOnChainActions } from \"./actions\";\nimport { getWalletClientAndConnection, getWalletProvider } from \"./wallet\";\nimport { splToken } from \"@goat-sdk/plugin-spl-token\";\n\nasync function createCrossmintPlugin(\n    getSetting: (key: string) => string | undefined\n): Promise<Plugin> {\n    const { walletClient, connection } = await getWalletClientAndConnection(getSetting);\n    if (!walletClient) {\n        throw new Error(\"Wallet client not found\");\n    }\n    console.log(\"walletClient\", walletClient);\n    const actions = await getOnChainActions({\n        wallet: walletClient,\n        // Add plugins here based on what actions you want to use\n        // See all available plugins at https://ohmygoat.dev/chains-wallets-plugins#plugins\n        plugins: [\n            // Add you solana plugins here\n            splToken({\n                connection,\n                network: \"mainnet\",\n            }),\n            // coingecko({\n            //  apiKey: getSetting(\"COINGECKO_API_KEY\")\n            // })\n        ],\n    });\n\n    return {\n        name: \"[Crossmint] Solana Onchain Actions\",\n        description: \"Crossmint Solana integration plugin\",\n        providers: [getWalletProvider(walletClient)],\n        evaluators: [],\n        services: [],\n        actions: actions,\n    };\n}\n\nexport default createCrossmintPlugin;\n"],"mappings":";AAAA;AAAA,EAGI;AAAA,EAEA;AAAA,OACG;AACP;AAAA,EAEI;AAAA,EAIA;AAAA,EAEA;AAAA,EACA;AAAA,OACG;AAaP,eAAsB,kBAAsD;AAAA,EACxE;AAAA,EACA;AACJ,GAA8D;AAC1D,QAAM,QAAQ,MAAM,SAAwB;AAAA,IACxC;AAAA,IACA;AAAA,IACA,aAAa;AAAA,EACjB,CAAC;AAED,SAAO,MACF,IAAI,CAAC,YAAY;AAAA,IACd,GAAG;AAAA,IACH,MAAM,OAAO,KAAK,YAAY;AAAA,EAClC,EAAE,EACD,IAAI,CAAC,SAAS,aAAa,IAAI,CAAC;AACzC;AAEA,SAAS,aAAa,MAAoB;AACtC,SAAO;AAAA,IACH,MAAM,KAAK;AAAA,IACX,SAAS,CAAC;AAAA,IACV,aAAa,KAAK;AAAA,IAClB,UAAU,YAAY;AAAA,IACtB,SAAS,OACL,SACA,SACA,OACA,SACA,aACmB;AACnB,UAAI;AACA,YAAI,eACA,SAAU,MAAM,QAAQ,aAAa,OAAO;AAChD,uBACI,MAAM,QAAQ,yBAAyB,YAAY;AAEvD,cAAM,mBAAmB;AAAA,UACrB;AAAA,UACA;AAAA,QACJ;AACA,cAAM,aAAa,MAAM;AAAA,UACrB;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AAEA,cAAM,mBAAmB,KAAK,WAAW,UAAU,UAAU;AAC7D,YAAI,CAAC,iBAAiB,SAAS;AAC3B,qBAAW;AAAA,YACP,MAAM,iCAAiC,KAAK,IAAI,KAAK,iBAAiB,MAAM,OAAO;AAAA,YACnF,SAAS,EAAE,OAAO,iBAAiB,MAAM,QAAQ;AAAA,UACrD,CAAC;AACD,iBAAO;AAAA,QACX;AAEA,cAAM,SAAS,MAAM,KAAK,OAAO,iBAAiB,IAAI;AACtD,cAAM,kBAAkB;AAAA,UACpB;AAAA,UACA;AAAA,UACA;AAAA,QACJ;AACA,cAAM,WAAW,MAAM;AAAA,UACnB;AAAA,UACA;AAAA,QACJ;AAEA,mBAAW,EAAE,MAAM,UAAU,SAAS,OAAO,CAAC;AAC9C,eAAO;AAAA,MACX,SAAS,OAAO;AACZ,cAAM,eACF,iBAAiB,QAAQ,MAAM,UAAU,OAAO,KAAK;AACzD,mBAAW;AAAA,UACP,MAAM,0BAA0B,KAAK,IAAI,KAAK,YAAY;AAAA,UAC1D,SAAS,EAAE,OAAO,aAAa;AAAA,QACnC,CAAC;AACD,eAAO;AAAA,MACX;AAAA,IACJ;AAAA,IACA,UAAU,CAAC;AAAA,EACf;AACJ;AAEA,SAAS,wBAAwB,MAAY,OAAsB;AAC/D,QAAM,kBAAkB;AAAA;AAAA,+EAEmD,KAAK,IAAI;AAAA,EACtF,2BAA2B,IAAI,KAAK,UAAU,CAAC;AAAA;AAE7C,SAAO,eAAe,EAAE,OAAO,UAAU,gBAAgB,CAAC;AAC9D;AAEA,eAAe,mBACX,SACA,SACA,MACgB;AAChB,QAAM,EAAE,OAAO,IAAI,MAAM,iBAAiB;AAAA,IACtC;AAAA,IACA;AAAA,IACA,YAAY,WAAW;AAAA,IACvB,QAAQ,KAAK;AAAA,EACjB,CAAC;AAED,SAAO;AACX;AAEA,SAAS,uBACL,MACA,QACA,OACM;AACN,QAAM,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAoBf,KAAK,IAAI;AAAA;AAAA,EAErB,KAAK,UAAU,MAAM,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOpB,SAAO,eAAe,EAAE,OAAO,UAAU,iBAAiB,CAAC;AAC/D;AAEA,eAAe,iBACX,SACA,SACe;AACf,SAAO,aAAa;AAAA,IAChB;AAAA,IACA;AAAA,IACA,YAAY,WAAW;AAAA,EAC3B,CAAC;AACL;;;ACtLA,SAAS,kBAAkB;AAC3B,SAAS,iBAAiB;AAE1B,eAAsB,6BAClB,YACF;AACE,QAAM,SAAS,WAAW,mBAAmB;AAC7C,MAAI,CAAC,QAAQ;AACT,UAAM,IAAI,MAAM,oCAAoC;AAAA,EACxD;AACA,QAAM,QAAQ,WAAW,iBAAiB;AAC1C,MAAI,CAAC,OAAO;AACR,UAAM,IAAI,MAAM,kCAAkC;AAAA,EACtD;AACA,QAAM,MAAM,WAAW,eAAe;AACtC,MAAI,CAAC,KAAK;AACN,UAAM,IAAI,MAAM,gCAAgC;AAAA,EACpD;AACA,QAAM,UAAU,WAAW,SAAS;AACpC,MAAI,CAAC,SAAS;AACV,UAAM,IAAI,MAAM,0BAA0B;AAAA,EAC9C;AAEA,QAAM,EAAE,UAAU,IAAI,UAAU,MAAM;AAEtC,QAAM,aAAa,IAAI,WAAW,SAAS,WAAW;AAEtD,SAAO;AAAA,IACH,cAAc,MAAM,UAAU;AAAA,MAC1B,OAAO;AAAA,MACP;AAAA,MACA;AAAA,MACA;AAAA,IACJ,CAAC;AAAA,IACD;AAAA,EACJ;AACJ;AAEO,SAAS,kBAAkB,cAA4B;AAC1D,SAAO;AAAA,IACH,MAAM,MAA8B;AAChC,UAAI;AACA,cAAM,UAAU,aAAa,WAAW;AACxC,cAAM,UAAU,MAAM,aAAa,UAAU,OAAO;AACpD,eAAO,0BAA0B,OAAO;AAAA,WAAc,OAAO;AAAA,MACjE,SAAS,OAAO;AACZ,gBAAQ,MAAM,oCAAoC,KAAK;AACvD,eAAO;AAAA,MACX;AAAA,IACJ;AAAA,EACJ;AACJ;;;ACjDA,SAAS,gBAAgB;AAEzB,eAAe,sBACX,YACe;AACf,QAAM,EAAE,cAAc,WAAW,IAAI,MAAM,6BAA6B,UAAU;AAClF,MAAI,CAAC,cAAc;AACf,UAAM,IAAI,MAAM,yBAAyB;AAAA,EAC7C;AACA,UAAQ,IAAI,gBAAgB,YAAY;AACxC,QAAM,UAAU,MAAM,kBAAkB;AAAA,IACpC,QAAQ;AAAA;AAAA;AAAA,IAGR,SAAS;AAAA;AAAA,MAEL,SAAS;AAAA,QACL;AAAA,QACA,SAAS;AAAA,MACb,CAAC;AAAA;AAAA;AAAA;AAAA,IAIL;AAAA,EACJ,CAAC;AAED,SAAO;AAAA,IACH,MAAM;AAAA,IACN,aAAa;AAAA,IACb,WAAW,CAAC,kBAAkB,YAAY,CAAC;AAAA,IAC3C,YAAY,CAAC;AAAA,IACb,UAAU,CAAC;AAAA,IACX;AAAA,EACJ;AACJ;AAEA,IAAO,cAAQ;","names":[]}